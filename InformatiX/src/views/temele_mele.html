<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In&lt;form&gt;atiX</title>
    <link rel="icon" type="image/png" href="../../../public/favicons/icon.png">
    <link rel="stylesheet" href="../../../public/css/header1.css">
    <link rel="stylesheet" href="../../../public/css/temele_mele.css">
    <link rel="stylesheet" href="../../../public/css/footer.css">
    <script src="../../../public/js/temele-mele.js"></script>
    <script src="../../../public/js/checkAdmin.js"></script>
</head>

<body>
    <header>
        <nav>
            <ul class="sidebar">
                <li onclick=hideSidebar()><a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="26"
                            viewBox="0 96 960 960" width="26">
                            <path
                                d="m249 849-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z" />
                        </svg></a></li>
                <li><a href="/home" onclick=hideSidebar()>Home</a></li>
                <li><a href="/home/probleme" onclick=hideSidebar()>Probleme</a></li>
                <li><a href="/home/clasele-mele" onclick="hideSidebar()">Clasele mele</a></li>
                <li><a href="/home/profil" onclick="hideSidebar()">Profil</a></li>
                <li><a href="/home/administrare" onclick="hideSidebar()">Administrare</a></li>
                <li><a href="/" onclick="hideSidebar()">Logout</a></li>
            </ul>
            <ul class="menu">
                <li><a href="/home">Home</a></li>
                <li class="hideOnMobile"><a href="/home/probleme">Probleme</a></li>
                <li class="hideOnMobile"><a href="/home/clasele-mele">Clasele mele</a></li>
                <li class="hideOnMobile"><a href="/home/profil">Profil</a></li>
                <li class="hideOnMobile"><a href="/home/administrare">Administrare</a></li>
                <li class="hideOnMobile"><a href="/">Logout</a></li>
                <li class="menu-button" onclick=showSidebar()><a href="#"><svg xmlns="http://www.w3.org/2000/svg"
                            height="26" viewBox="0 96 960 960" width="26">
                            <path d="M120 816v-60h720v60H120Zm0-210v-60h720v60H120Zm0-210v-60h720v60H120Z" />
                        </svg></a></li>
            </ul>
        </nav>
    </header>
    <div class="container_princ">
    <h2 class="temeleMele">Temele Mele</h2>
    <div class="teme" id="temele">
    </div>
</div>

    <div id="addTemaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddTemaModal()">&times;</span>
            <h2>Adaugă Temă Nouă</h2>
            <label for="clasaInput">Clasa:</label>
            <input type="text" id="clasaInput" placeholder="Clasa a X-a B/XB/10B"><br><br>
            <label for="deadlineInput">Deadline:</label>
            <input type="date" id="deadlineInput"><br><br>
            <button onclick="submitNewTema()">Submit</button>
        </div>
    </div>

    <div id="searchModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSearchModal()">&times;</span>
            <h2>Cauta Probleme</h2>
            <input type="text" id="searchInput" placeholder="Cauta problema...">
            <button onclick="searchProblem()">Adauga</button>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserModal()">&times;</span>
            <h2>Select User</h2>
            <ul>
                <li onclick="openUserSolution()">User 1</li>
                <li onclick="openUserSolution()">User 2</li>
                <li onclick="openUserSolution()">User 3</li>
                <li onclick="openUserSolution()">User 4</li>
                <li onclick="openUserSolution()">User 5</li>
            </ul>
        </div>
    </div>

    <div id="evaluateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEvaluateModal()">&times;</span>
            <h2>Evalueaza Elevii</h2>
            <ul>
                <li onclick="openUserSolution()">User 1</li>
                <li onclick="openUserSolution()">User 2</li>
                <li onclick="openUserSolution()">User 3</li>
                <li onclick="openUserSolution()">User 4</li>
                <li onclick="openUserSolution()">User 5</li>
            </ul>
        </div>
    </div>
    <div id="problemModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProblemModal()">&times;</span>
            <h2>Rezolva Probleme</h2>
            <ul>
                <li onclick="openProblemSolution('Problema 1')">Problema 1</li>
                <li onclick="openProblemSolution('Problema 2')">Problema 2</li>
                <li onclick="openProblemSolution('Problema 3')">Problema 3</li>
                <li onclick="openProblemSolution('Problema 4')">Problema 4</li>
            </ul>
        </div>
    </div>
    <footer>
        <p>@ Contact</p>
    </footer>
    <script>
        function showSidebar() {
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'flex'
        }

        function hideSidebar() {
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'none'
        }

        function closeSearchModal() {
            var modal = document.getElementById('searchModal');
            modal.style.display = "none";
        }

        function closeEvaluateModal() {
            var modal = document.getElementById('evaluateModal');
            modal.style.display = "none";
        }

        function closeProblemModal() {
            var modal = document.getElementById('problemModal');
            modal.style.display = "none";
        }

        function openUserSolution() {
            const userType = getUrlParam('userType');
            const url = 'solution.html';
            if (url.includes('?')) {
                window.location.href = `${url}&userType=${userType}`;
            } else {
                window.location.href = `${url}?userType=${userType}`;
            }
        }

        function closeAddTemaModal() {
            var modal = document.getElementById('addTemaModal');
            modal.style.display = "none";
        }

        function openAddTemaModal() {
            var modal = document.getElementById('addTemaModal');
            modal.style.display = "block";
        }

        function submitNewTema() {

            const clasaInput = document.getElementById('clasaInput').value.trim();
            const deadlineInput = document.getElementById('deadlineInput').value;

            if (!clasaInput || !deadlineInput) {
                alert('Toate câmpurile sunt obligatorii.');
                return;
            }

            const today = new Date();
            const deadlineDate = new Date(deadlineInput);

            if (deadlineDate <= today) {
                alert('Data trebuie să fie după data curentă.');
                return;
            }
            const url = window.location.href;
            const classId = url.substring(url.lastIndexOf('/') + 1);

            const data = {
                nume: clasaInput,
                deadline: deadlineInput,
                classId: classId
            };
            console.log(data);
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/createTema', true);
            xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        alert(response.message);
                        document.getElementById('clasaInput').value = '';
                        document.getElementById('deadlineInput').value = '';
                        closeAddTemaModal();
                    } else {
                        var response = JSON.parse(xhr.responseText);
                        alert(response.message);
                    }
                }
            };

            xhr.send(JSON.stringify(data));
            closeAddTemaModal();
            document.getElementById('clasaInput').value = '';
            document.getElementById('deadlineInput').value = '';
        }

        function searchProblem() {
            alert("Problem added!");
            closeSearchModal();
        }
    </script>

<script>
    function getTeme() {
        const url = window.location.href;
        const classId = url.substring(url.lastIndexOf('/') + 1);
        const xhr = new XMLHttpRequest();
        xhr.open('GET', `/api/getTeme?id=${classId}`, true);
        
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    const teme = JSON.parse(xhr.responseText);
                    console.log(teme);
                    displayTeme(teme);
                } else {
                    alert('Eroare la obținerea temelor.');
                }
            }
        };
        
        xhr.send();
    }

    // Funcția pentru a afișa temele în HTML
    function displayTeme(teme) {
    const temeContainer = document.getElementById('temele');
    temeContainer.innerHTML = '';

    // Ensure teme is an array
    const temeArray = Array.isArray(teme) ? teme : [teme];

    temeArray.forEach(function(tema) {
        const divTema = document.createElement('div');
        divTema.classList.add('tema');

        divTema.innerHTML = `
            <h3>${tema.nume}</h3>
            <p>Clasa: ${tema.id_clasa}</p>
            <p>Deadline: ${new Date(tema.deadline).toLocaleString()}</p>
            <ul>
                <!-- Aici poți adăuga dinamic listă cu problemele temei -->
            </ul>
        `;

        const ulProbleme = divTema.querySelector('ul');
        tema.probleme?.forEach(function(problema) {
            const liProblema = document.createElement('li');
            liProblema.textContent = problema;
            ulProbleme.appendChild(liProblema);
        });

        temeContainer.appendChild(divTema);
    });
}

    window.onload = function() {
        getTeme();
    };
</script>

</body>

</html>